<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Pit Filler — pitfiller • terra</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Pit Filler — pitfiller"><meta name="description" content="It fills the pits (depressions with no outlet ) through a terrain erosion model (PEM4PIT)"><meta property="og:description" content="It fills the pits (depressions with no outlet ) through a terrain erosion model (PEM4PIT)"><meta property="og:image" content="https://rspatial.github.io/terra/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">terra</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.8-0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../reference/terra-package.html">Description</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://rspatial.org">Tutorials</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rspatial/terra/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Pit Filler</h1>

      <div class="d-none name"><code>pitfiller.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>It fills the pits (depressions with no outlet ) through a terrain erosion model (PEM4PIT)</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S4 method for class 'SpatRaster'</span></span>
<span><span class="fu">pitfiller</span><span class="op">(</span><span class="va">x</span>, pit <span class="op">=</span> <span class="cn">NULL</span>, flowdir <span class="op">=</span> <span class="cn">NULL</span>, niter <span class="op">=</span> <span class="fl">10</span>, lambda <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                 deviation_type <span class="op">=</span> <span class="st">"lad"</span>, U <span class="op">=</span> <span class="fl">1</span>, D <span class="op">=</span> <span class="fl">300</span>, beta <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>                 theta_exp <span class="op">=</span> <span class="fl">0.5</span>, filename <span class="op">=</span> <span class="st">""</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>SpatRaster wih digital elevation model.</p></dd>

  <dt id="arg-pit">pit<a class="anchor" aria-label="anchor" href="#arg-pit"></a></dt>
<dd><p>SpatRaster wih pits. See <code><a href="pitfinder.html">pitfinder</a></code></p></dd>

  <dt id="arg-flowdir">flowdir<a class="anchor" aria-label="anchor" href="#arg-flowdir"></a></dt>
<dd><p>SpatRaster wih flow direction or <code>NULL</code>, intarnally calculated. See <code><a href="flowdirD8ltd.html">flowdirD8lad</a></code></p></dd>

  <dt id="arg-niter">niter<a class="anchor" aria-label="anchor" href="#arg-niter"></a></dt>
<dd><p>number of iterations</p></dd>

  <dt id="arg-lambda-deviation-type">lambda,deviation_type<a class="anchor" aria-label="anchor" href="#arg-lambda-deviation-type"></a></dt>
<dd><p>default is <code>deviation_type="lad"</code> and <code>lambda=0</code>. see <code><a href="flowdirD8ltd.html">flowdirD8lad</a></code> .</p></dd>

  <dt id="arg-u-d-beta-theta-exp">U,D,beta,theta_exp<a class="anchor" aria-label="anchor" href="#arg-u-d-beta-theta-exp"></a></dt>
<dd><p>See PEM4PIT model parameters. See details.</p></dd>

  <dt id="arg-filename">filename<a class="anchor" aria-label="anchor" href="#arg-filename"></a></dt>
<dd><p>character. Output filename</p></dd>

  <dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>additional arguments for writing files as in <code><a href="writeRaster.html">writeRaster</a></code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>


<p>A <code><a href="SpatRaster-class.html">SpatRaster-class</a></code> (raster) delevation model with pits filled.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The PEM4PIT model, which stands for Physical Erosion Model for PIT and flat areas correction, is designed to address issues in Digital Elevation Models (DEMs) related to pits and flat areas. These issues can significantly affect hydrologic modeling and analysis. The model uses a simplified physical representation of erosion processes at the basin scale to correct these inaccuracies.</p>
<p>- **Automatic parameter estimation**: It automatically calibrates parameters to improve the accuracy of DEMs.
  - **Hydrologic applications**: It enhances the representation of flow directions and contributing areas, which are crucial for hydrologic simulations.
  - **Erosion processes**: The model accounts for both fluvial and diffusive erosion processes, providing a more realistic depiction of terrain.</p>
<p>Model is based on the steady sediment balance equation:</p>
<p>$$0 = U - \beta A^{\theta} \left( \frac{z - z_d}{\Delta l} \right) + \frac{4D}{\Delta x^2} \left( \overset{\smile}{z} - z \right)$$</p>
<p>where:</p>
<p>- \(U\): uplift
  - \(\beta\): A coefficient that represents the influence of the erosion process on the terrain.
  - \(A\): The area contributing to the flow, which affects the erosion rate.
  - \(\theta\): An exponent that modifies the effect of the contributing area \(A\) on the erosion process.
  - \(z\): The elevation at a specific point in the DEM.
  - \(z_d\): The elevation of a downstream point, used to calculate the slope.
  - \(\Delta l\): The distance between the points \(z\) and \(z_d\), representing the length over which the slope is calculated.
  - \(D\): A diffusion coefficient that represents the rate of terrain smoothing due to diffusive erosion processes.
  - \(\Delta x\): The grid spacing in the DEM, used to normalize the diffusion term.
  - \(\overset{\smile}{z}\): The average elevation of neighboring points, used to calculate the diffusive erosion effect.</p>
<p>### Solving the Equation for \(z\)</p>
<p>Starting with the equation:</p>
<p>$$0 = U - \beta A^{\theta} \left( \frac{z - z_d}{\Delta l} \right) + \frac{4D}{\Delta x^2} \left( \overset{\smile}{z} - z \right)$$</p>
<p>1. Rearrange the terms to isolate \(z\):</p>
<p>$$\beta A^{\theta} \left( \frac{z - z_d}{\Delta l} \right) = U + \frac{4D}{\Delta x^2} \left( \overset{\smile}{z} - z \right)$$</p>
<p>2. Distribute \(\beta A^{\theta}\) and \(\frac{4D}{\Delta x^2}\):</p>
<p>$$\beta A^{\theta} \frac{z}{\Delta l} - \beta A^{\theta} \frac{z_d}{\Delta l} = U + \frac{4D \overset{\smile}{z}}{\Delta x^2} - \frac{4D z}{\Delta x^2}$$</p>
<p>3. Combine like terms involving \(z\):</p>
<p>$$\beta A^{\theta} \frac{z}{\Delta l} + \frac{4D z}{\Delta x^2} = U + \frac{4D \overset{\smile}{z}}{\Delta x^2} + \beta A^{\theta} \frac{z_d}{\Delta l}$$</p>
<p>4. Factor out \(z\):</p>
<p>$$z \left( \beta A^{\theta} \frac{1}{\Delta l} + \frac{4D}{\Delta x^2} \right) = U + \frac{4D \overset{\smile}{z}}{\Delta x^2} + \beta A^{\theta} \frac{z_d}{\Delta l}$$</p>
<p>5. Solve for \(z\):</p>
<p>$$z = \frac{U \Delta l \Delta x^2 + 4D \Delta l \overset{\smile}{z} + \beta A^{\theta} \Delta x^2 z_d}{\beta A^{\theta} \Delta x^2 + 4D \Delta l}$$</p>
<p>So, the solution for \(z\) is:</p>
<p>$$z = \frac{U \Delta l \Delta x^2 + 4D \Delta l \overset{\smile}{z} + \beta A^{\theta} \Delta x^2 z_d}{\beta A^{\theta} \Delta x^2 + 4D \Delta l}$$</p>
<p>see reference:
  Grimaldi, S., Nardi, F., Di Benedetto, F., Istanbulluoglu, E., &amp; Bras, R. L. (2007).
  "A physically-based method for removing pits in digital elevation models."
  Advances in Water Resources, 30(10), 2151-2158. doi:10.1016/j.advwatres.2006.11.016
  <a href="https://www.sciencedirect.com/science/article/pii/S0309170807000644" class="external-link">https://www.sciencedirect.com/science/article/pii/S0309170807000644</a></p>

<p>Further references:</p>
<p>Tucker, G. E., and R. L. Bras (1998), Hillslope processes, drainage density, and landscape morphology, Water Resour. Res., 34(10), 2751–2764, doi:10.1029/98WR01474 <a href="https://agupubs.onlinelibrary.wiley.com/doi/abs/10.1029/98wr01474" class="external-link">https://agupubs.onlinelibrary.wiley.com/doi/abs/10.1029/98wr01474</a> .</p>
<p>Niemann, J. D., R. L. Bras, and D. Veneziano (2003), A physically based interpolation method for fluvially eroded topography, Water Resour. Res., 39, 1017, doi:10.1029/2001WR001050, 1. <a href="https://agupubs.onlinelibrary.wiley.com/doi/full/10.1029/2001WR001050" class="external-link">https://agupubs.onlinelibrary.wiley.com/doi/full/10.1029/2001WR001050</a></p>
<p>Niemann, J. D., R. L. Bras, D. Veneziano and Rinaldo A. (2001) Jeffrey D. Niemann, Rafael L. Bras, Daniele Veneziano, Andrea Rinaldo, Impacts of surface elevation on the growth and scaling properties of simulated river networks,Geomorphology,Volume 40, Issues 1–2,2001,Pages 37-55,ISSN 0169-555X,
https://doi.org/10.1016/S0169-555X(01)00036-8.
<a href="https://www.sciencedirect.com/science/article/pii/S0169555X01000368" class="external-link">https://www.sciencedirect.com/science/article/pii/S0169555X01000368</a> Keywords: Drainage networks; Models; Self-similarity; Fractal geometry</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>


<p>Emanuele Cordano</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="terrain.html">terrain</a></code>,<code><a href="watershed.html">watershed</a></code>,<code><a href="flowdirD8ltd.html">flowdirD8ltd</a></code>,<code><a href="pitfinder.html">pitfinder</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"ex/elev.tif"</span>, package<span class="op">=</span><span class="st">"terra"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">elev</span> <span class="op">&lt;-</span> <span class="fu"><a href="rast.html">rast</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="project.html">project</a></span><span class="op">(</span>y<span class="op">=</span><span class="st">"epsg:32632"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">flowdir</span> <span class="op">&lt;-</span> <span class="fu"><a href="flowdirD8ltd.html">flowdirD8lad</a></span><span class="op">(</span><span class="va">elev</span>,lambda<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pits</span> <span class="op">&lt;-</span> <span class="fu"><a href="pitfinder.html">pitfinder</a></span><span class="op">(</span><span class="va">flowdir</span>,pits_on_boundary<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">elev2</span> <span class="op">&lt;-</span> <span class="fu">pitfiller</span><span class="op">(</span>x<span class="op">=</span><span class="va">elev</span>,pit<span class="op">=</span><span class="va">pits</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> class       : SpatRaster </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dimensions  : 111, 78, 1  (nrow, ncol, nlyr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> resolution  : 772.033, 772.033  (x, y)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> extent      : 263811.2, 324029.8, 5479328, 5565024  (xmin, xmax, ymin, ymax)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> coord. ref. : WGS 84 / UTM zone 32N (EPSG:32632) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> source(s)   : memory</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> name        : elevation </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> min value   :         0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> max value   :       112 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">flowdir2</span> <span class="op">&lt;-</span> <span class="fu"><a href="terrain.html">terrain</a></span><span class="op">(</span><span class="va">elev2</span>,<span class="st">"flowdir"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">flowdir2</span> <span class="op">&lt;-</span> <span class="fu"><a href="flowdirD8ltd.html">flowdirD8lad</a></span><span class="op">(</span><span class="va">elev2</span>,lambda<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pits2</span> <span class="op">&lt;-</span> <span class="fu"><a href="pitfinder.html">pitfinder</a></span><span class="op">(</span><span class="va">flowdir</span>,pits_on_boundary<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robert J. Hijmans.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

